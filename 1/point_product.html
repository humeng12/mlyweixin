<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>积分兑换</title>
		<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport" />
		
		<link rel="stylesheet" type="text/css" href="../common/common.css" />
		<link href="../common/detail.css" rel="stylesheet" />
		<!--轮播图的css-->
		<link rel="stylesheet" href="../mui/css/mui.min.css">
		
		<script src="../mui/js/mui.min.js"></script>
		
		<script src="../js/jquery-2.1.4.js"></script>
		
		<script src="../common/vue.js"></script>
		
	</head>
	<body>
		
			<!--轮播图-->
		<div class="mui-content" style="margin-top: 10px;">
			<div id="slider" class="mui-slider">
				<div class="mui-slider-group mui-slider-loop">
					<!-- 额外增加的一个节点(循环轮播：第一个节点是最后一张轮播) -->
					<div class="mui-slider-item mui-slider-item-duplicate">
						<a href="#">
							<img src="../images/banner.png" style="height: 18rem;"/>
							<p style="opacity: 0.5;" class="mui-slider-title">幸福就是可以一起睡觉</p>
						</a>
					</div>
					<div class="mui-slider-item">
						<a href="#">
							<img src="../images/banner.png" style="height: 18rem;"/>
							<p style="opacity: 0.5;" class="mui-slider-title">幸福就是可以一起睡觉</p>
						</a>
					</div>
					<div class="mui-slider-item">
						<a href="#">
							<img src="../images/banner.png" style="height: 18rem;"/>
							<p style="opacity: 0.5;" class="mui-slider-title">幸福就是可以一起睡觉</p>
						</a>
					</div>
					<div class="mui-slider-item">
						<a href="#">
							<img src="../images/banner.png" style="height: 18rem;"/>
							<p style="opacity: 0.5;" class="mui-slider-title">幸福就是可以一起睡觉</p>
						</a>
					</div>
					<div class="mui-slider-item">
						<a href="#">
							<img src="../images/banner.png" style="height: 18rem;"/>
							<p style="opacity: 0.5;" class="mui-slider-title">幸福就是可以一起睡觉</p>
						</a>
					</div>
					<!-- 额外增加的一个节点(循环轮播：最后一个节点是第一张轮播) -->
					<div class="mui-slider-item mui-slider-item-duplicate">
						<a href="#">
							<img src="../images/banner.png" style="height: 18rem;"/>
							<p style="opacity: 0.5;" class="mui-slider-title">幸福就是可以一起睡觉</p>
						</a>
					</div>
				</div>
				<div class="mui-slider-indicator mui-text-right" style="height: 1.3rem;">
					<div class="mui-indicator mui-active"></div>
					<div class="mui-indicator"></div>
					<div class="mui-indicator"></div>
					<div class="mui-indicator"></div>
				</div>
				
			</div>
		</div>
		
		
		<div class="theme clearfloat" style="margin-top: 10px;">
			<div class="boutit clearfloat">
		        <samp>套餐活动</samp>
		    </div>
		    
		    <div class="mui-content" style="margin-top: 10px;">		
				<div class="mui-card" style="margin: 0;padding: 0;">
					<div class="mui-card-content">
						<img src="../images/hb.jpg" style="width: 100%;height: 13rem;"/>
						<p style="margin-left: 10px;font-size: 12px;">让你享瓷白美肌嫩白同时缩小毛孔 改善黑头粉刺</p>
					</div>
					<div class="mui-card-footer">
						<a class="mui-card-link">黑脸娃娃极致白二选一</a>
						<a class="mui-card-link">积分:<strong class="strong_red">99</strong></a>
					</div>
				</div>
			</div>
		
		</div>
		
		<div class="theme clearfloat" style="margin-top: 10px;">
			<div class="boutit clearfloat">
		        <samp>礼品兑换</samp>
		    </div>
		    
		    <div class="content clearfloat" id="gifts" style="margin-top: 15px;">
		    	
		    	<div class="list clearfloat fl" v-for="item in gift">
					<a href="javascript:void(0);" onclick="exchange(this);">
						<p id="giftid" v-text="item.id" style="display: none;"></p>
						<div class="tu clearfloat fr">
						    <span></span>
						    <img id="proimg" :src="item.gift_pic"/>
						</div>
						<div class="shang clearfloat fl box-s">
						    <p class="tit over" v-text="item.gift_name" id="proname">利仁电火锅</p>
						    
						    <p><span>积分:</span><span class="over red" v-text="item.exchange_integral" id="projifen">11000</span></p>
						</div>
					</a>
				</div>
		    </div>
		</div>
		
		<!--弹出购物车内容-->
		<div class="am-share">
		    <div class="am-share-footer">
		        <button class="share_btn"><img src="../images/chahao.png" /></button>
		    </div>
		    <div class="am-share-sns">
		    	
		        <div class="sdetail clearfloat">
		        	
		            <div class="top clearfloat">
		                <div class="tu clearfloat fl">
		                    <span></span>
		                    <img src="../images/1f1.jpg" />
		                </div>
		                <div class="you clearfloat fl">
		                    <p class="tit">单反相机</p>
		                    <span>100000积分</span>
		                </div>
		            </div>
		           
		            <div class="bottom clearfloat">
		                <p class="fl">兑换数量</p>
		                <div class="you clearfloat fl">
		                    <ul style="width: 180px;">
		                        <li id="down"><img src="../images/jian.jpg" /></li>
		                        <li id="count">1</li>
		                        <li id="up"><img src="../images/jia.jpg" /></li>
		                    </ul>
		                </div>
		            </div>
		        </div>
		        
		    </div>
		    <a href="javascript:void(0);" onclick="btnclick()" class="shop-btn">兑换</a>
		</div>
			<script src="../mui/js/mui.min.js"></script>
		
		<script>
			
			var slider = mui("#slider");
			slider.slider({
				interval: 5000
			});
			
			
			
			$.ajax({
				type:"get",
				url:"http://chenxiaolong.top/shoph/1/mly/public/getGifts",
				async:true,
				data:{},
				dataType:'json',
				success:function(data){
					
					if(data['data']){
						
						new Vue({
							el:'#gifts',
							data:{
								gift:data['data']
							}
						});
					}
				}
			});
			
			var tmpjifen = 0;
			
			var proid = 0;
			
			var proname = '';
			
			function exchange(obj)
			{	
				
				proid = $(obj).find('#giftid').text();
				proname = $(obj).find('#proname').text();
				var proimg = $(obj).find('#proimg').attr('src');
				var projifen = $(obj).find('#projifen').text();
				
				tmpjifen = projifen;
				
				$('.am-share .am-share-sns .sdetail .top .tu img').attr('src',proimg);
				$('.am-share .am-share-sns .sdetail .top .you span').text(projifen+'积分');
				
				$('.sdetail .top .you p').text(proname); 
				
				$(".am-share").addClass("am-modal-active");
				if($(".sharebg").length>0){
					$(".sharebg").addClass("sharebg-active");
				}else{
					$("body").append('<div class="sharebg"></div>');
					$(".sharebg").addClass("sharebg-active");
				}
				$(".sharebg-active,.share_btn").click(function(){
					$(".am-share").removeClass("am-modal-active");	
					setTimeout(function(){
						$(".sharebg-active").removeClass("sharebg-active");	
						$(".sharebg").remove();	
					},300);
				});
			}
			
			
			var count = $("#count");
			var tmpcount = 1;
			
			$('.bottom #up').click(function(){
				
				tmpcount++;
				$('.bottom #count').text(tmpcount);
				$('.sdetail .top .you span').text(parseInt(tmpcount) * parseInt(tmpjifen) + '积分');
			});
			
		    $('.bottom #down').click(function(){
		    	if(tmpcount == 1){
		    		
		    	}else{
		    		tmpcount--;
		    	}
		    	$('.bottom #count').text(tmpcount);
		    	$('.sdetail .top .you span').text(parseInt(tmpcount) * parseInt(tmpjifen) + '积分');
		    });
		    
		    
		    
		    function btnclick()
		    {
		    	var userid = localStorage.getItem('userid');
		    	
		    	$('.shop-btn').attr('disabled',"true");
		    	
		    	$.ajax({
		    		type:"get",
		    		url:"http://chenxiaolong.top/shoph/1/mly/public/giftTrade",
		    		async:true,
		    		data:{userid:userid,giftid:proid,giftname:proname,giftnum:tmpcount,giftscore:tmpjifen},
		    		success:function(data){
		    			$('.shop-btn').removeAttr("disabled");
		    			mui.toast(data['message'],{ duration:'short', type:'div' });
		    		},
		    		error:function(data){
		    			$('.shop-btn').removeAttr("disabled");
		    		}
		    	});
		    }
		
		</script>
	</body>
</html>
